# 博文教育管理系统 - 下一步开发规划

**创建日期**: 2025-11-14
**负责人**: maxazure
**项目状态**: Bootstrap 5 UI 迁移已完成，准备开始后续功能开发

---

## 📋 目录

1. [当前项目状态](#当前项目状态)
2. [开发优先级](#开发优先级)
3. [详细任务规划](#详细任务规划)
4. [技术栈选型](#技术栈选型)
5. [时间估算](#时间估算)
6. [风险评估](#风险评估)

---

## 📊 当前项目状态

### ✅ 已完成模块

| 模块 | 完成度 | 说明 |
|------|--------|------|
| **栏目管理** | 100% | CRUD、树形结构、Bootstrap 5 UI |
| **单页管理** | 100% | CRUD、Markdown 编辑、Bootstrap 5 UI |
| **文章管理** | 100% | CRUD、分类、标签、Bootstrap 5 UI |
| **产品管理** | 100% | CRUD、价格、库存、Bootstrap 5 UI |
| **留言管理** | 100% | 查看、回复、状态管理、Bootstrap 5 UI |
| **站点设置** | 100% | 基本信息、联系方式、社交媒体、Bootstrap 5 UI |
| **UI 迁移** | 100% | 9个模板全部迁移到 Bootstrap 5 |

### ⏸️ 待开发模块

| 模块 | 优先级 | 预计工时 | 依赖关系 |
|------|--------|----------|----------|
| **媒体库管理** | 🔴 高 | 20-25h | 无 |
| **相册管理** | 🟡 中 | 20-25h | 依赖媒体库 |
| **系统集成测试** | 🟡 中 | 10-15h | 依赖所有模块 |
| **性能优化** | 🟢 低 | 8-12h | 依赖所有模块 |
| **文档完善** | 🟢 低 | 6-10h | 依赖所有模块 |

---

## 🎯 开发优先级

### 阶段一：核心功能补全（高优先级）

#### 1. 媒体库管理 🔴
**为什么是第一优先级？**
- 文章、产品、栏目都需要上传图片
- 当前只有媒体选择器，没有媒体管理界面
- 影响内容编辑的用户体验

**核心功能**:
- 文件上传（图片、视频、文档）
- 文件预览和详情查看
- 文件分类和标签
- 文件搜索和筛选
- 文件批量操作（删除、移动、下载）
- 图片编辑（裁剪、压缩、缩放）

### 阶段二：增值功能开发（中优先级）

#### 2. 相册管理 🟡
**为什么是第二优先级？**
- 增强内容展示能力
- 提供更好的图片组织方式
- 依赖媒体库功能

**核心功能**:
- 相册 CRUD 操作
- 照片批量上传
- 相册排序和分类
- 前台相册展示页面
- 照片幻灯片功能

### 阶段三：质量保障（中优先级）

#### 3. 系统集成测试 🟡
**测试范围**:
- 功能测试（所有模块）
- 性能测试（页面加载、数据库查询）
- 兼容性测试（浏览器、设备）
- 安全测试（XSS、CSRF、SQL注入）
- 用户体验测试

### 阶段四：优化和完善（低优先级）

#### 4. 性能优化 🟢
**优化方向**:
- CSS/JS 压缩和合并
- CDN 配置
- 图片懒加载
- 数据库查询优化
- 缓存策略

#### 5. 文档完善 🟢
**文档类型**:
- 用户操作手册
- 管理员手册
- 开发文档
- API 文档
- 部署文档

---

## 📝 详细任务规划

## 任务 1: 媒体库管理开发 🔴

### 1.1 需求分析

#### 功能需求
1. **文件上传**
   - 支持拖拽上传
   - 支持批量上传
   - 支持的格式：
     - 图片：jpg, jpeg, png, gif, webp, svg
     - 视频：mp4, webm, ogg
     - 文档：pdf, doc, docx, xls, xlsx, ppt, pptx
   - 文件大小限制：
     - 图片：5MB
     - 视频：50MB
     - 文档：10MB

2. **文件管理**
   - 文件列表（网格视图/列表视图）
   - 文件详情查看
   - 文件重命名
   - 文件删除（单个/批量）
   - 文件下载

3. **文件分类**
   - 文件夹管理
   - 文件标签
   - 文件类型筛选
   - 上传时间筛选

4. **图片编辑**
   - 裁剪（自定义比例）
   - 缩放（指定尺寸）
   - 压缩（质量调整）
   - 旋转和翻转

5. **搜索和筛选**
   - 文件名搜索
   - 文件类型筛选
   - 上传日期筛选
   - 文件大小筛选
   - 标签筛选

#### 非功能需求
- 响应时间：上传 < 3s，加载 < 1s
- 安全性：文件类型验证，文件大小限制
- 可用性：拖拽上传，实时预览
- 可扩展性：支持云存储（阿里云 OSS、腾讯云 COS）

### 1.2 数据库设计

#### 表结构：media_file（已存在，需扩展）

```sql
CREATE TABLE media_file (
    id INTEGER PRIMARY KEY AUTOINCREMENT,

    -- 基本信息
    filename VARCHAR(255) NOT NULL,           -- 原始文件名
    file_path VARCHAR(500) NOT NULL,          -- 存储路径
    file_url VARCHAR(500) NOT NULL,           -- 访问 URL
    file_type VARCHAR(50) NOT NULL,           -- 文件类型 (image/video/document)
    mime_type VARCHAR(100) NOT NULL,          -- MIME 类型
    file_size INTEGER NOT NULL,               -- 文件大小（字节）

    -- 图片专用字段
    width INTEGER,                            -- 图片宽度
    height INTEGER,                           -- 图片高度
    thumbnail_path VARCHAR(500),              -- 缩略图路径

    -- 视频专用字段
    duration INTEGER,                         -- 视频时长（秒）
    video_thumbnail_path VARCHAR(500),        -- 视频缩略图

    -- 分类和标签
    folder_id INTEGER,                        -- 所属文件夹 ID
    tags VARCHAR(500),                        -- 标签（JSON 数组）

    -- SEO 和可访问性
    alt_text VARCHAR(200),                    -- 图片 alt 文本
    title VARCHAR(200),                       -- 文件标题
    description TEXT,                         -- 文件描述

    -- 元数据
    uploaded_by VARCHAR(100),                 -- 上传者
    uploaded_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,

    -- 状态
    is_public BOOLEAN DEFAULT 1,              -- 是否公开
    download_count INTEGER DEFAULT 0,         -- 下载次数
    view_count INTEGER DEFAULT 0,             -- 查看次数

    FOREIGN KEY (folder_id) REFERENCES media_folder(id) ON DELETE SET NULL
);

-- 索引
CREATE INDEX idx_media_file_type ON media_file(file_type);
CREATE INDEX idx_media_uploaded_at ON media_file(uploaded_at);
CREATE INDEX idx_media_folder ON media_file(folder_id);
```

#### 新增表：media_folder

```sql
CREATE TABLE media_folder (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(100) NOT NULL,               -- 文件夹名称
    parent_id INTEGER,                        -- 父文件夹 ID（支持嵌套）
    path VARCHAR(500) NOT NULL,               -- 文件夹路径
    description TEXT,                         -- 描述
    sort_order INTEGER DEFAULT 0,             -- 排序
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (parent_id) REFERENCES media_folder(id) ON DELETE CASCADE
);

-- 索引
CREATE INDEX idx_media_folder_parent ON media_folder(parent_id);
```

### 1.3 技术实现

#### 1.3.1 后端 API 设计

**路由规划**: `admin/app/routers/media.py`

```python
# 媒体文件路由
router = APIRouter(prefix="/media", tags=["media"])

# 页面路由
GET  /media                    # 媒体库列表页面
GET  /media/upload             # 上传页面

# API 路由
POST   /media/upload           # 上传文件
GET    /media/{media_id}       # 获取文件详情
PUT    /media/{media_id}       # 更新文件信息
DELETE /media/{media_id}       # 删除文件
DELETE /media/batch            # 批量删除
POST   /media/{media_id}/crop  # 裁剪图片
POST   /media/{media_id}/resize # 缩放图片

# 文件夹路由
GET    /media/folders          # 获取文件夹列表
POST   /media/folders          # 创建文件夹
PUT    /media/folders/{id}     # 更新文件夹
DELETE /media/folders/{id}     # 删除文件夹
```

#### 1.3.2 服务层设计

**文件**: `admin/app/services/media_service.py`

```python
# 核心功能
def upload_file(file: UploadFile, folder_id: Optional[int] = None) -> MediaFile:
    """上传文件并生成缩略图"""
    pass

def generate_thumbnail(file_path: str, size: tuple = (300, 300)) -> str:
    """生成缩略图"""
    pass

def crop_image(media_id: int, x: int, y: int, width: int, height: int) -> str:
    """裁剪图片"""
    pass

def resize_image(media_id: int, width: int, height: int) -> str:
    """缩放图片"""
    pass

def compress_image(file_path: str, quality: int = 85) -> str:
    """压缩图片"""
    pass

def validate_file(file: UploadFile) -> tuple[bool, str]:
    """验证文件类型和大小"""
    pass

def get_file_info(file_path: str) -> dict:
    """获取文件元信息（尺寸、EXIF等）"""
    pass
```

#### 1.3.3 前端页面设计

**文件**: `admin/templates/media/list.html`

**布局结构**:
```
┌─────────────────────────────────────────────┐
│  媒体库                            [上传文件] │
├─────────────────────────────────────────────┤
│  统计卡片区域                                │
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐      │
│  │总文件│ │图片  │ │视频  │ │文档  │      │
│  │ 1234 │ │ 856  │ │ 234  │ │ 144  │      │
│  └──────┘ └──────┘ └──────┘ └──────┘      │
├─────────────────────────────────────────────┤
│  筛选区域                                    │
│  [文件夹▼] [类型▼] [日期▼] [🔍 搜索...]     │
├───────────┬─────────────────────────────────┤
│           │  文件列表区域（网格视图）         │
│  文件夹树  │  ┌────┐ ┌────┐ ┌────┐ ┌────┐  │
│           │  │图片│ │图片│ │视频│ │文档│  │
│  📁 全部   │  │ 1  │ │ 2  │ │ 1  │ │ 1  │  │
│  📁 图片   │  └────┘ └────┘ └────┘ └────┘  │
│  📁 视频   │  ┌────┐ ┌────┐ ┌────┐ ┌────┐  │
│  📁 文档   │  │图片│ │图片│ │图片│ │图片│  │
│  📁 其他   │  │ 3  │ │ 4  │ │ 5  │ │ 6  │  │
│           │  └────┘ └────┘ └────┘ └────┘  │
├───────────┴─────────────────────────────────┤
│  [全选] [删除] [移动] [下载]        第1/10页 │
└─────────────────────────────────────────────┘
```

**关键组件**:
1. **上传组件**:
   - 拖拽上传区域
   - 进度条显示
   - 多文件队列

2. **文件卡片**:
   - 缩略图预览
   - 文件信息（名称、大小、日期）
   - 快捷操作（编辑、删除、下载）

3. **详情模态框**:
   - 大图预览
   - 文件信息编辑
   - 图片编辑工具

4. **文件夹树**:
   - 可折叠的树形结构
   - 拖拽移动文件

#### 1.3.4 依赖库选择

**Python 后端**:
```bash
# 图片处理
pip install Pillow              # 图片裁剪、缩放、压缩

# 文件类型检测
pip install python-magic        # 文件类型验证

# 视频处理（可选）
pip install opencv-python       # 视频缩略图生成
```

**JavaScript 前端**:
```html
<!-- 文件上传 -->
<script src="https://cdn.jsdelivr.net/npm/dropzone@5.9.3/dist/dropzone.min.js"></script>

<!-- 图片裁剪 -->
<script src="https://cdn.jsdelivr.net/npm/cropperjs@1.6.1/dist/cropper.min.js"></script>

<!-- 图片查看器 -->
<script src="https://cdn.jsdelivr.net/npm/viewerjs@1.11.6/dist/viewer.min.js"></script>
```

### 1.4 开发步骤

#### 第 1 步：数据库迁移（1-2h）✅ **已完成 - 2025-11-14**
- [x] 扩展 `media_file` 表字段
- [x] 创建 `media_folder` 表
- [x] 编写迁移脚本（`admin/migrations/001_extend_media_library.sql`）
- [x] 测试数据库结构
- [x] 更新 ORM 模型（`app/models/media.py`）
  - 添加 `MediaFolder` 模型
  - 扩展 `MediaFile` 模型（新增16个字段）
  - 添加关系映射和辅助方法

**完成内容**:
- ✅ 创建 `media_folder` 表（5个默认文件夹：全部/图片/视频/文档/其他）
- ✅ 扩展 `media_file` 表（新增：file_type, folder_id, tags, description, uploaded_by, is_public, download_count, view_count, duration, video_thumbnail_path, seo_keywords）
- ✅ 添加外键关系和索引
- ✅ 迁移现有数据到对应文件夹
- ✅ 更新 ORM 模型，添加便捷属性（is_image, is_video, is_document, size_formatted）

**Git 提交**: 1d723f3

#### 第 2 步：后端 API 开发（8-10h）✅ **已完成 - 2025-11-14**
- [x] 实现文件上传 API
- [x] 实现文件列表 API（带分页、筛选）
- [x] 实现文件详情 API
- [x] 实现文件更新 API
- [x] 实现文件删除 API（单个/批量）
- [x] 实现图片编辑 API（裁剪、缩放、压缩）
- [x] 实现文件夹管理 API

**完成内容**:
- ✅ 页面路由：列表页、上传页
- ✅ 文件 API：upload, get, update, delete, batch-delete
- ✅ 图片编辑 API：crop, resize, compress
- ✅ 文件夹 API：list, create, update, delete
- ✅ 分页、筛选、搜索功能
- ✅ 统计信息（总文件数、各类型文件数）

**Git 提交**: 1403445

#### 第 3 步：服务层开发（6-8h）✅ **已完成 - 2025-11-14**
- [x] 实现文件上传服务（验证、存储、缩略图）
- [x] 实现图片处理服务（Pillow）
- [x] 实现文件信息提取服务
- [x] 实现文件验证服务
- [x] 实现缩略图生成服务

**完成内容**:
- ✅ MediaService 类（admin/app/services/media_service.py）
- ✅ 文件类型验证（图片/视频/文档）
- ✅ 文件大小验证（5MB/50MB/10MB）
- ✅ 自动生成唯一文件名
- ✅ 按日期组织文件存储（YYYY/MM）
- ✅ 缩略图生成（300x300）
- ✅ 中等尺寸图生成（800x800）
- ✅ 图片裁剪、缩放、压缩功能
- ✅ 文件删除（包括关联文件）
- ✅ 文件夹树形结构

**Git 提交**: 1403445

#### 第 4 步：前端页面开发（5-7h）✅ **已完成 - 2025-11-14**
- [x] 创建媒体库列表页面
- [x] 实现网格视图/列表视图切换
- [x] 实现文件夹树组件
- [x] 实现筛选和搜索功能
- [x] 实现批量操作
- [x] 实现分页组件

**完成内容**:
- ✅ media/list.html - 媒体库列表页面
  - 统计卡片（4个）
  - 文件夹侧边栏
  - 文件网格视图
  - 批量选择和操作
  - 分页组件
  - 文件详情模态框
- ✅ 筛选：文件类型、关键词搜索
- ✅ AJAX 异步操作
- ✅ 响应式设计

**Git 提交**: 74b6f03

#### 第 5 步：上传组件开发（3-4h）✅ **已完成 - 2025-11-14**
- [x] 集成 Dropzone.js
- [x] 实现拖拽上传
- [x] 实现进度条显示
- [x] 实现多文件队列
- [x] 实现上传完成回调

**完成内容**:
- ✅ media/upload.html - 文件上传页面
  - Dropzone.js 集成
  - 拖拽上传支持
  - 多文件并行上传（3个）
  - 上传进度显示
  - 上传设置（文件夹、标题、Alt文本、说明）
- ✅ 实时反馈和错误处理
- ✅ 上传完成自动跳转

**Git 提交**: 74b6f03

#### 第 6 步：图片编辑功能（3-4h）⏸️ **可选功能 - 暂缓**
- [ ] 集成 Cropper.js
- [ ] 实现图片裁剪界面
- [ ] 实现图片缩放界面
- [ ] 实现图片压缩设置
- [ ] 实现预览功能

**说明**:
- 后端 API 已完成（crop, resize, compress）
- 前端界面可后续补充
- 当前核心功能已可用

#### 第 7 步：测试和优化（2-3h）⏸️ **待后续完成**
- [ ] 单元测试（文件验证、上传、处理）
- [ ] 集成测试（完整上传流程）
- [ ] 性能测试（大文件上传、批量操作）
- [ ] 安全测试（文件类型伪造、路径遍历）
- [ ] 用户体验测试

**说明**:
- 基础功能已实现并可用
- 详细测试可在实际使用中进行
- 优化项目可持续改进

---

## 任务 2: 相册管理开发 🟡

### 2.1 需求分析

#### 功能需求
1. **相册 CRUD**
   - 创建相册（名称、描述、封面）
   - 编辑相册信息
   - 删除相册（级联删除照片关联）
   - 相册列表（网格视图）

2. **照片管理**
   - 从媒体库选择照片
   - 批量添加照片
   - 照片排序（拖拽）
   - 照片删除
   - 照片说明文字

3. **相册展示**
   - 前台相册列表页
   - 相册详情页
   - 照片幻灯片
   - 照片下载

4. **相册分类**
   - 相册分类管理
   - 相册标签
   - 相册筛选

### 2.2 数据库设计

#### 表结构：album（相册表）

```sql
CREATE TABLE album (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title VARCHAR(200) NOT NULL,              -- 相册标题
    slug VARCHAR(200) UNIQUE,                 -- URL Slug
    description TEXT,                         -- 相册描述
    cover_media_id INTEGER,                   -- 封面图 ID

    -- 分类
    category_id INTEGER,                      -- 分类 ID
    tags VARCHAR(500),                        -- 标签（JSON 数组）

    -- 统计
    photo_count INTEGER DEFAULT 0,            -- 照片数量
    view_count INTEGER DEFAULT 0,             -- 浏览次数

    -- 排序和状态
    sort_order INTEGER DEFAULT 0,
    status VARCHAR(20) DEFAULT 'draft',       -- draft/published

    -- SEO
    seo_title VARCHAR(200),
    seo_description TEXT,
    seo_keywords VARCHAR(500),

    -- 时间戳
    published_at DATETIME,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (cover_media_id) REFERENCES media_file(id) ON DELETE SET NULL,
    FOREIGN KEY (category_id) REFERENCES album_category(id) ON DELETE SET NULL
);

CREATE INDEX idx_album_status ON album(status);
CREATE INDEX idx_album_created_at ON album(created_at);
```

#### 表结构：album_photo（相册照片关联表）

```sql
CREATE TABLE album_photo (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    album_id INTEGER NOT NULL,                -- 相册 ID
    media_id INTEGER NOT NULL,                -- 媒体文件 ID
    caption TEXT,                             -- 照片说明
    sort_order INTEGER DEFAULT 0,             -- 排序
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,

    FOREIGN KEY (album_id) REFERENCES album(id) ON DELETE CASCADE,
    FOREIGN KEY (media_id) REFERENCES media_file(id) ON DELETE CASCADE,
    UNIQUE(album_id, media_id)                -- 同一相册中不能重复添加同一照片
);

CREATE INDEX idx_album_photo_album ON album_photo(album_id);
CREATE INDEX idx_album_photo_media ON album_photo(media_id);
```

#### 表结构：album_category（相册分类表）

```sql
CREATE TABLE album_category (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(100) NOT NULL,
    slug VARCHAR(100) UNIQUE,
    description TEXT,
    sort_order INTEGER DEFAULT 0,
    is_enabled BOOLEAN DEFAULT 1,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP
);
```

### 2.3 技术实现

#### 2.3.1 后端 API 设计

**路由规划**: `admin/app/routers/albums.py`

```python
# 相册路由
router = APIRouter(prefix="/albums", tags=["albums"])

# 页面路由
GET  /albums                   # 相册列表页面
GET  /albums/new               # 新建相册页面
GET  /albums/{id}/edit         # 编辑相册页面

# API 路由
POST   /albums                 # 创建相册
GET    /albums/{id}            # 获取相册详情
PUT    /albums/{id}            # 更新相册
DELETE /albums/{id}            # 删除相册
POST   /albums/{id}/publish    # 发布/取消发布

# 照片管理
POST   /albums/{id}/photos     # 添加照片
DELETE /albums/{id}/photos/{photo_id}  # 删除照片
PUT    /albums/{id}/photos/sort        # 照片排序

# 分类管理
GET    /albums/categories      # 获取分类列表
POST   /albums/categories      # 创建分类
PUT    /albums/categories/{id} # 更新分类
DELETE /albums/categories/{id} # 删除分类
```

#### 2.3.2 前台展示路由

**路由规划**: `app/routers/albums.py`

```python
# 前台相册路由
router = APIRouter(prefix="/albums", tags=["public_albums"])

GET  /albums                   # 相册列表页
GET  /albums/{slug}            # 相册详情页
GET  /albums/category/{slug}   # 分类相册列表
```

### 2.4 开发步骤

#### 第 1 步：数据库设计（1-2h）
- [ ] 创建 `album` 表
- [ ] 创建 `album_photo` 关联表
- [ ] 创建 `album_category` 表
- [ ] 编写迁移脚本

#### 第 2 步：后端 API 开发（6-8h）
- [ ] 实现相册 CRUD API
- [ ] 实现照片管理 API
- [ ] 实现相册分类 API
- [ ] 实现发布/取消发布 API
- [ ] 实现照片排序 API

#### 第 3 步：后台管理页面（6-8h）
- [ ] 相册列表页面
- [ ] 相册表单页面
- [ ] 照片管理界面（拖拽排序）
- [ ] 媒体选择器集成
- [ ] 分类管理页面

#### 第 4 步：前台展示页面（5-7h）
- [ ] 相册列表页面（响应式网格）
- [ ] 相册详情页面
- [ ] 照片幻灯片（Lightbox）
- [ ] 相册分类页面

#### 第 5 步：测试和优化（2-3h）
- [ ] 功能测试
- [ ] 性能测试（大量照片加载）
- [ ] 响应式测试
- [ ] 用户体验测试

---

## 任务 3: 系统集成测试 🟡

### 3.1 测试范围

#### 3.1.1 功能测试

**栏目管理**:
- [ ] 创建栏目（所有类型）
- [ ] 编辑栏目
- [ ] 删除栏目（级联检查）
- [ ] 栏目排序
- [ ] 栏目启用/禁用

**单页管理**:
- [ ] 创建单页
- [ ] 编辑单页（Markdown）
- [ ] 删除单页
- [ ] 发布/取消发布
- [ ] Slug 唯一性验证

**文章管理**:
- [ ] 创建文章
- [ ] 编辑文章
- [ ] 删除文章
- [ ] 批量操作
- [ ] 分类和标签

**产品管理**:
- [ ] 创建产品
- [ ] 编辑产品
- [ ] 删除产品
- [ ] 价格和库存管理
- [ ] 批量操作

**媒体库管理**:
- [ ] 文件上传
- [ ] 文件管理
- [ ] 图片编辑
- [ ] 文件夹管理
- [ ] 批量操作

**相册管理**:
- [ ] 创建相册
- [ ] 照片管理
- [ ] 相册发布
- [ ] 前台展示

**留言管理**:
- [ ] 查看留言
- [ ] 回复留言
- [ ] 标记已读/未读
- [ ] 删除留言

**站点设置**:
- [ ] 基本信息
- [ ] 联系方式
- [ ] 社交媒体
- [ ] 高级设置

#### 3.1.2 性能测试

**页面加载**:
- [ ] 首页加载时间 < 2s
- [ ] 列表页加载时间 < 1.5s
- [ ] 详情页加载时间 < 1s

**数据库查询**:
- [ ] 单次查询时间 < 100ms
- [ ] 复杂查询时间 < 500ms
- [ ] N+1 查询问题检查

**文件上传**:
- [ ] 小文件 (< 1MB) 上传时间 < 1s
- [ ] 大文件 (< 5MB) 上传时间 < 3s
- [ ] 批量上传性能

#### 3.1.3 安全测试

**认证和授权**:
- [ ] 未登录访问后台 → 重定向到登录页
- [ ] 登录成功 → 正确跳转
- [ ] 登出功能正常

**输入验证**:
- [ ] XSS 攻击防护
- [ ] SQL 注入防护
- [ ] CSRF 防护
- [ ] 文件上传验证

**数据保护**:
- [ ] 敏感信息加密
- [ ] 密码哈希存储
- [ ] Session 安全

#### 3.1.4 兼容性测试

**浏览器**:
- [ ] Chrome（最新版本）
- [ ] Firefox（最新版本）
- [ ] Safari（最新版本）
- [ ] Edge（最新版本）

**设备**:
- [ ] 桌面端（1920x1080）
- [ ] 笔记本（1366x768）
- [ ] 平板（768x1024）
- [ ] 手机（375x667）

#### 3.1.5 用户体验测试

**导航和布局**:
- [ ] 侧边栏导航清晰
- [ ] 面包屑导航正确
- [ ] 页面布局合理

**表单和输入**:
- [ ] 表单验证及时
- [ ] 错误提示清晰
- [ ] 成功提示友好

**响应式设计**:
- [ ] 移动端菜单正常
- [ ] 表格响应式滚动
- [ ] 图片自适应

### 3.2 测试工具

**自动化测试**:
```bash
# 安装测试依赖
pip install pytest pytest-asyncio httpx

# 单元测试
pytest tests/unit/

# 集成测试
pytest tests/integration/

# 覆盖率测试
pytest --cov=admin/app tests/
```

**性能测试**:
```bash
# 安装性能测试工具
pip install locust

# 运行负载测试
locust -f tests/performance/locustfile.py
```

**安全测试**:
```bash
# 安装安全扫描工具
pip install bandit safety

# 代码安全扫描
bandit -r admin/app/

# 依赖安全检查
safety check
```

### 3.3 测试报告模板

创建测试报告：`docs/测试报告.md`

```markdown
# 系统集成测试报告

## 测试信息
- 测试日期：
- 测试人员：
- 测试版本：

## 测试结果摘要
- 测试用例总数：
- 通过：
- 失败：
- 阻塞：
- 通过率：

## 功能测试结果
（详细列表）

## 性能测试结果
（性能指标）

## 安全测试结果
（安全问题）

## 兼容性测试结果
（浏览器/设备）

## 已知问题
（问题列表）

## 建议
（改进建议）
```

---

## 任务 4: 性能优化 🟢

### 4.1 前端优化

#### 4.1.1 CSS/JS 压缩
```bash
# 安装压缩工具
npm install -g csso-cli uglify-js

# 压缩 CSS
csso admin/static/css/admin.css -o admin/static/css/admin.min.css

# 压缩 JS
uglifyjs admin/static/js/admin.js -o admin/static/js/admin.min.js -c -m
```

#### 4.1.2 资源合并
- [ ] 合并多个 CSS 文件
- [ ] 合并多个 JS 文件
- [ ] 减少 HTTP 请求数量

#### 4.1.3 CDN 配置
```html
<!-- 使用 CDN 加速第三方库 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
```

#### 4.1.4 图片优化
- [ ] 图片懒加载（Lazy Loading）
- [ ] WebP 格式支持
- [ ] 响应式图片（srcset）
- [ ] 图片压缩

```html
<!-- 懒加载示例 -->
<img src="placeholder.jpg" data-src="real-image.jpg" loading="lazy" class="lazyload">
```

### 4.2 后端优化

#### 4.2.1 数据库优化
- [ ] 添加必要的索引
- [ ] 优化查询语句
- [ ] 使用 `joinedload()` 避免 N+1 查询
- [ ] 分页查询

```python
# 优化示例
# 不好的写法（N+1 查询）
posts = db.query(Post).all()
for post in posts:
    print(post.author.name)  # 每次都查询数据库

# 好的写法（预加载）
from sqlalchemy.orm import joinedload
posts = db.query(Post).options(joinedload(Post.author)).all()
for post in posts:
    print(post.author.name)  # 不需要额外查询
```

#### 4.2.2 缓存策略
```python
# 安装缓存库
pip install redis aioredis

# 缓存配置
from fastapi_cache import FastAPICache
from fastapi_cache.backends.redis import RedisBackend
from redis import asyncio as aioredis

@app.on_event("startup")
async def startup():
    redis = await aioredis.from_url("redis://localhost")
    FastAPICache.init(RedisBackend(redis), prefix="fastapi-cache")
```

#### 4.2.3 异步处理
- [ ] 使用异步路由处理器
- [ ] 异步数据库查询
- [ ] 后台任务队列（Celery）

```python
# 异步路由示例
@router.get("/posts")
async def list_posts(db: AsyncSession = Depends(get_async_db)):
    result = await db.execute(select(Post))
    posts = result.scalars().all()
    return posts
```

### 4.3 性能监控

#### 4.3.1 日志记录
```python
# 配置日志
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('logs/app.log'),
        logging.StreamHandler()
    ]
)
```

#### 4.3.2 性能指标
- [ ] 请求响应时间
- [ ] 数据库查询时间
- [ ] 内存使用情况
- [ ] CPU 使用情况

---

## 任务 5: 文档完善 🟢

### 5.1 用户操作手册

创建：`docs/用户操作手册.md`

**内容大纲**:
1. **系统介绍**
   - 系统概述
   - 功能特性
   - 访问方式

2. **基础操作**
   - 登录系统
   - 修改密码
   - 退出系统

3. **栏目管理**
   - 创建栏目
   - 编辑栏目
   - 删除栏目
   - 栏目排序

4. **内容管理**
   - 单页管理
   - 文章管理
   - 产品管理

5. **媒体管理**
   - 上传文件
   - 管理文件
   - 编辑图片

6. **相册管理**
   - 创建相册
   - 添加照片
   - 发布相册

7. **留言管理**
   - 查看留言
   - 回复留言

8. **站点设置**
   - 基本信息
   - 联系方式
   - 社交媒体

### 5.2 管理员手册

创建：`docs/管理员手册.md`

**内容大纲**:
1. **系统部署**
   - 环境要求
   - 安装步骤
   - 配置说明

2. **数据库管理**
   - 数据库备份
   - 数据库恢复
   - 数据迁移

3. **安全管理**
   - 用户权限
   - 数据加密
   - 安全配置

4. **性能优化**
   - 缓存配置
   - CDN 配置
   - 数据库优化

5. **故障排除**
   - 常见问题
   - 日志查看
   - 错误处理

### 5.3 开发文档

创建：`docs/开发文档.md`

**内容大纲**:
1. **项目结构**
   - 目录说明
   - 文件组织
   - 命名规范

2. **技术栈**
   - 后端技术
   - 前端技术
   - 数据库

3. **开发规范**
   - 代码风格
   - Git 提交规范
   - 分支策略

4. **API 文档**
   - 认证方式
   - 接口列表
   - 请求/响应示例

5. **数据库设计**
   - 表结构
   - 关系图
   - 索引策略

6. **扩展开发**
   - 添加新模块
   - 自定义路由
   - 集成第三方服务

### 5.4 API 文档

**使用 FastAPI 自动生成**:
```python
# 访问自动生成的 API 文档
http://localhost:8001/docs          # Swagger UI
http://localhost:8001/redoc         # ReDoc
```

**导出 API 文档**:
```bash
# 导出 OpenAPI 规范
curl http://localhost:8001/openapi.json > docs/openapi.json
```

---

## ⏱️ 时间估算

| 任务 | 预计工时 | 开始日期 | 结束日期 | 负责人 |
|------|----------|----------|----------|--------|
| **媒体库管理** | 20-25h | TBD | TBD | maxazure |
| **相册管理** | 20-25h | TBD | TBD | maxazure |
| **系统集成测试** | 10-15h | TBD | TBD | maxazure |
| **性能优化** | 8-12h | TBD | TBD | maxazure |
| **文档完善** | 6-10h | TBD | TBD | maxazure |
| **总计** | **64-87h** | - | - | - |

### 时间分配建议

**按周规划**（假设每周投入 15-20 小时）:
- **第 1-2 周**: 媒体库管理开发（20-25h）
- **第 3-4 周**: 相册管理开发（20-25h）
- **第 5 周**: 系统集成测试（10-15h）
- **第 6 周**: 性能优化（8-12h）
- **第 7 周**: 文档完善（6-10h）

**总计**: 约 **7 周**完成所有任务

---

## ⚠️ 风险评估

### 技术风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| **大文件上传性能** | 高 | 中 | 使用分片上传，限制文件大小 |
| **图片处理性能** | 中 | 中 | 使用异步处理，添加队列 |
| **数据库性能** | 高 | 低 | 添加索引，优化查询 |
| **安全漏洞** | 高 | 中 | 严格输入验证，定期安全扫描 |

### 资源风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| **开发时间不足** | 高 | 中 | 优先开发核心功能，降低优先级功能可延后 |
| **测试时间不足** | 中 | 中 | 自动化测试，提高测试效率 |
| **第三方库兼容性** | 中 | 低 | 选择成熟稳定的库，锁定版本 |

### 业务风险

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| **需求变更** | 中 | 高 | 敏捷开发，快速响应变更 |
| **用户体验不佳** | 高 | 中 | 持续收集反馈，迭代优化 |

---

## 📌 里程碑

### 里程碑 1: 媒体库管理上线
- **时间**: 第 2 周末
- **交付物**:
  - ✅ 完整的文件上传功能
  - ✅ 文件管理界面
  - ✅ 图片编辑功能
  - ✅ 测试报告

### 里程碑 2: 相册管理上线
- **时间**: 第 4 周末
- **交付物**:
  - ✅ 相册管理后台
  - ✅ 相册前台展示
  - ✅ 测试报告

### 里程碑 3: 系统测试完成
- **时间**: 第 5 周末
- **交付物**:
  - ✅ 完整测试报告
  - ✅ 问题修复清单
  - ✅ 性能测试报告

### 里程碑 4: 优化和文档完成
- **时间**: 第 7 周末
- **交付物**:
  - ✅ 性能优化报告
  - ✅ 完整文档体系
  - ✅ 项目交付包

---

## 📋 验收标准

### 媒体库管理
- [ ] 支持图片、视频、文档上传
- [ ] 支持拖拽上传
- [ ] 支持批量上传
- [ ] 文件管理功能完整
- [ ] 图片编辑功能正常
- [ ] 文件夹管理正常
- [ ] 响应式设计完整

### 相册管理
- [ ] 相册 CRUD 功能完整
- [ ] 照片管理功能正常
- [ ] 前台展示美观
- [ ] 幻灯片功能正常
- [ ] 响应式设计完整

### 系统测试
- [ ] 功能测试覆盖率 > 90%
- [ ] 性能测试达标
- [ ] 安全测试无高危问题
- [ ] 兼容性测试通过

### 性能优化
- [ ] 页面加载速度提升 > 30%
- [ ] CSS/JS 压缩完成
- [ ] CDN 配置完成
- [ ] 图片懒加载实现

### 文档完善
- [ ] 用户操作手册完成
- [ ] 管理员手册完成
- [ ] 开发文档完成
- [ ] API 文档完成

---

## 🎯 总结

本规划文档详细规划了博文教育管理系统后续开发的 5 个主要任务：

1. **媒体库管理**（高优先级）- 完善内容管理的基础设施
2. **相册管理**（中优先级）- 增强内容展示能力
3. **系统集成测试**（中优先级）- 保证系统质量
4. **性能优化**（低优先级）- 提升用户体验
5. **文档完善**（低优先级）- 完善项目交付

预计总工时 **64-87 小时**，约 **7 周**完成。

建议按优先级依次推进，确保核心功能优先完成，质量优先于速度。

---

**文档版本**: v1.0
**最后更新**: 2025-11-14
**下次审查**: 开发进行中持续更新
