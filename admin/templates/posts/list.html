<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>文章列表 - 管理后台</title>
</head>
<body>
    <h1>文章管理</h1>
    <div>
        <a href="/admin/posts/new">新建文章</a>
    </div>
    
    <!-- 筛选表单 -->
    <form method="GET" action="/admin/posts">
        <select name="column_id">
            <option value="">所有栏目</option>
            {% for col in columns %}
            <option value="{{ col.id }}" {% if col.id == current_column_id %}selected{% endif %}>
                {{ col.name }}
            </option>
            {% endfor %}
        </select>
        
        <select name="status_filter">
            <option value="">所有状态</option>
            <option value="draft" {% if current_status == 'draft' %}selected{% endif %}>草稿</option>
            <option value="published" {% if current_status == 'published' %}selected{% endif %}>已发布</option>
            <option value="offline" {% if current_status == 'offline' %}selected{% endif %}>已下线</option>
        </select>
        
        <input type="text" name="keyword" value="{{ current_keyword or '' }}" placeholder="搜索关键词">
        <button type="submit">筛选</button>
    </form>
    
    <!-- 文章列表 -->
    <table border="1">
        <thead>
            <tr>
                <th>ID</th>
                <th>标题</th>
                <th>栏目</th>
                <th>状态</th>
                <th>推荐</th>
                <th>置顶</th>
                <th>更新时间</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {% for post in posts %}
            <tr>
                <td>{{ post.id }}</td>
                <td>{{ post.title }}</td>
                <td>{{ post.column.name }}</td>
                <td>{{ post.status }}</td>
                <td>{{ '是' if post.is_recommended else '否' }}</td>
                <td>{{ '是' if post.is_pinned else '否' }}</td>
                <td>{{ post.updated_at }}</td>
                <td>
                    <a href="/admin/posts/{{ post.id }}/edit">编辑</a>
                    <button onclick="deletePost({{ post.id }})">删除</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <!-- 分页 -->
    <div>
        {% if page > 1 %}
        <a href="?page={{ page - 1 }}">上一页</a>
        {% endif %}
        <span>第 {{ page }} / {{ total_pages }} 页</span>
        {% if page < total_pages %}
        <a href="?page={{ page + 1 }}">下一页</a>
        {% endif %}
    </div>
    
    <script>
    function deletePost(id) {
        if (!confirm('确定删除此文章?')) return;
        fetch('/admin/posts/' + id, {method: 'DELETE'})
            .then(r => r.json())
            .then(d => {
                alert(d.message);
                if (d.success) location.reload();
            });
    }
    </script>
</body>
</html>
