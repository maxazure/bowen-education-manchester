{% extends "base.html" %}

{% block title %}数据导出 - 博文教育管理后台{% endblock %}

{% block content %}
<!-- 面包屑导航 -->
<nav aria-label="breadcrumb" class="mb-3 animate-fade-in">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/admin"><i class="bi bi-house-door me-1"></i>首页</a></li>
        <li class="breadcrumb-item active" aria-current="page">数据导出</li>
    </ol>
</nav>

<!-- 页面标题区 -->
<div class="page-header animate-fade-in">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1 class="page-title">
                <i class="bi bi-download text-primary me-2"></i>数据导出
            </h1>
            <p class="page-subtitle">导出网站内容数据为 CSV 或 JSON 格式</p>
        </div>
    </div>
</div>

<!-- 导出选项 -->
<div class="row g-4">
    <!-- 文章导出 -->
    <div class="col-lg-6">
        <div class="card h-100 animate-fade-in">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-file-earmark-text text-primary me-2"></i>文章导出
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted">导出所有文章数据，包含标题、内容、状态、浏览量等信息</p>

                <form action="/admin/export/posts" method="GET" target="_blank" class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">栏目筛选</label>
                        <select name="column_id" class="form-select">
                            <option value="">所有栏目</option>
                            {% for col in columns %}
                            <option value="{{ col.id }}">{{ col.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">状态筛选</label>
                        <select name="status_filter" class="form-select">
                            <option value="">所有状态</option>
                            <option value="draft">草稿</option>
                            <option value="published">已发布</option>
                            <option value="offline">已下线</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">开始日期</label>
                        <input type="date" name="start_date" class="form-control">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">结束日期</label>
                        <input type="date" name="end_date" class="form-control">
                    </div>
                    <div class="col-12">
                        <label class="form-label">导出格式</label>
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="format" id="postsCsv" value="csv" checked autocomplete="off">
                            <label class="btn btn-outline-primary" for="postsCsv">CSV 表格</label>
                            <input type="radio" class="btn-check" name="format" id="postsJson" value="json" autocomplete="off">
                            <label class="btn btn-outline-primary" for="postsJson">JSON 数据</label>
                        </div>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-download me-2"></i>导出文章
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 产品导出 -->
    <div class="col-lg-6">
        <div class="card h-100 animate-fade-in" style="animation-delay: 100ms">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-box-seam text-success me-2"></i>产品导出
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted">导出所有产品数据，包含名称、价格、分类、状态等信息</p>

                <form action="/admin/export/products" method="GET" target="_blank" class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">分类筛选</label>
                        <select name="category_id" class="form-select">
                            <option value="">所有分类</option>
                            {% for cat in product_categories %}
                            <option value="{{ cat.id }}">{{ cat.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">状态筛选</label>
                        <select name="status" class="form-select">
                            <option value="">所有状态</option>
                            <option value="active">在售</option>
                            <option value="inactive">停售</option>
                        </select>
                    </div>
                    <div class="col-12">
                        <label class="form-label">导出格式</label>
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="format" id="productsCsv" value="csv" checked autocomplete="off">
                            <label class="btn btn-outline-success" for="productsCsv">CSV 表格</label>
                            <input type="radio" class="btn-check" name="format" id="productsJson" value="json" autocomplete="off">
                            <label class="btn btn-outline-success" for="productsJson">JSON 数据</label>
                        </div>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-success w-100">
                            <i class="bi bi-download me-2"></i>导出产品
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 留言导出 -->
    <div class="col-lg-6">
        <div class="card h-100 animate-fade-in" style="animation-delay: 200ms">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-envelope text-warning me-2"></i>留言导出
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted">导出所有留言数据，包含联系信息、留言内容、状态等</p>

                <form action="/admin/export/contacts" method="GET" target="_blank" class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">状态筛选</label>
                        <select name="status" class="form-select">
                            <option value="">所有状态</option>
                            <option value="unread">未读</option>
                            <option value="read">已读</option>
                            <option value="handled">已处理</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">日期范围</label>
                        <input type="date" name="start_date" class="form-control" placeholder="开始日期">
                    </div>
                    <div class="col-12">
                        <label class="form-label">导出格式</label>
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="format" id="contactsCsv" value="csv" checked autocomplete="off">
                            <label class="btn btn-outline-warning" for="contactsCsv">CSV 表格</label>
                            <input type="radio" class="btn-check" name="format" id="contactsJson" value="json" autocomplete="off">
                            <label class="btn btn-outline-warning" for="contactsJson">JSON 数据</label>
                        </div>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-warning text-dark w-100">
                            <i class="bi bi-download me-2"></i>导出留言
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 相册导出 -->
    <div class="col-lg-6">
        <div class="card h-100 animate-fade-in" style="animation-delay: 300ms">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-images text-info me-2"></i>相册导出
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted">导出所有相册数据，包含标题、描述、图片数量等</p>

                <form action="/admin/export/galleries" method="GET" target="_blank" class="row g-3">
                    <div class="col-12">
                        <label class="form-label">导出格式</label>
                        <div class="btn-group w-100" role="group">
                            <input type="radio" class="btn-check" name="format" id="galleriesCsv" value="csv" checked autocomplete="off">
                            <label class="btn btn-outline-info" for="galleriesCsv">CSV 表格</label>
                            <input type="radio" class="btn-check" name="format" id="galleriesJson" value="json" autocomplete="off">
                            <label class="btn btn-outline-info" for="galleriesJson">JSON 数据</label>
                        </div>
                    </div>
                    <div class="col-12">
                        <button type="submit" class="btn btn-info text-white w-100">
                            <i class="bi bi-download me-2"></i>导出相册
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 统计报告 -->
    <div class="col-12">
        <div class="card animate-fade-in" style="animation-delay: 400ms">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="bi bi-bar-chart text-danger me-2"></i>数据统计报告
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted mb-3">获取网站整体数据统计报告，包括文章、产品、留言等数量统计</p>
                <button type="button" class="btn btn-danger" onclick="loadStatsReport()">
                    <i class="bi bi-graph-up me-2"></i>生成统计报告
                </button>

                <div id="statsReport" class="mt-4" style="display: none;">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <div class="card bg-primary-light border-0">
                                <div class="card-body text-center">
                                    <div class="display-6 fw-bold text-primary" id="reportPosts">-</div>
                                    <div class="text-muted">文章总数</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-success-light border-0">
                                <div class="card-body text-center">
                                    <div class="display-6 fw-bold text-success" id="reportProducts">-</div>
                                    <div class="text-muted">产品总数</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-warning-light border-0">
                                <div class="card-body text-center">
                                    <div class="display-6 fw-bold text-warning" id="reportContacts">-</div>
                                    <div class="text-muted">留言总数</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-info-light border-0">
                                <div class="card-body text-center">
                                    <div class="display-6 fw-bold text-info" id="reportGalleries">-</div>
                                    <div class="text-muted">相册总数</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// 加载统计报告
function loadStatsReport() {
    fetch('/admin/export/stats')
        .then(response => response.json())
        .then(data => {
            if (data.success && data.data) {
                const d = data.data;
                document.getElementById('reportPosts').textContent = d.posts.total;
                document.getElementById('reportProducts').textContent = d.products.total;
                document.getElementById('reportContacts').textContent = d.contacts.total;
                document.getElementById('reportGalleries').textContent = d.galleries.total;
                document.getElementById('statsReport').style.display = 'block';
                showToast('success', '统计报告已生成', '成功');
            }
        })
        .catch(error => {
            console.error('加载统计报告失败:', error);
            showToast('danger', '加载失败，请重试', '错误');
        });
}
</script>
{% endblock %}
